# 腾讯地图API Key配置说明

## 错误说明

如果遇到 `status: 311, message: "key格式错误"` 的错误，说明：

1. **Key未配置**：代码中的Key还是默认值 `YOUR_TENCENT_MAP_KEY`
2. **Key格式错误**：Key的格式不正确
3. **Key未激活**：Key可能还未激活或已过期

## 解决步骤

### 第一步：获取腾讯地图Key

1. 访问 [腾讯位置服务控制台](https://lbs.qq.com/)
2. 使用QQ或微信登录
3. 进入 **控制台** -> **我的应用** -> **创建应用**
4. 填写应用信息：
   - 应用名称：附近寻厕（或自定义）
   - 应用类型：选择 **微信小程序**
   - 应用描述：查找附近厕所的小程序
5. 创建后，在应用列表中可以看到 **Key（密钥）**
6. 复制这个Key（通常是32位的字符串，格式类似：`ABCD-EFGH-IJKL-MNOP-QRST-UVWX-YZ12-3456`）

### 第二步：配置Key到代码中

1. 打开文件：`pages/index/index.js`
2. 找到第97行左右：
   ```javascript
   const key = 'YOUR_TENCENT_MAP_KEY' // 需要替换为实际的腾讯地图key
   ```
3. 替换为你的实际Key：
   ```javascript
   const key = '你的实际Key值' // 例如：'ABCD-EFGH-IJKL-MNOP-QRST-UVWX-YZ12-3456'
   ```

### 第三步：配置request合法域名

1. 登录 [微信公众平台](https://mp.weixin.qq.com/)
2. 进入你的小程序后台
3. 开发 -> 开发管理 -> 开发设置
4. 找到 **服务器域名** -> **request合法域名**
5. 添加域名：`https://apis.map.qq.com`
6. 保存

### 第四步：检查Key权限

在腾讯位置服务控制台中，确保你的Key有以下权限：
- ✅ WebService API
- ✅ 地点搜索
- ✅ 周边搜索

## Key格式说明

腾讯地图Key的格式通常是：
- 32位字符串
- 可能包含连字符（-）
- 例如：`ABCD-EFGH-IJKL-MNOP-QRST-UVWX-YZ12-3456`

**注意**：
- Key不要包含多余的空格
- Key要完整复制，不要遗漏字符
- 确保Key已激活（在控制台可以看到状态）

## 测试Key是否有效

配置好Key后，重新编译小程序，如果：
- ✅ 能正常搜索到厕所 → Key配置成功
- ❌ 仍然报错 → 检查Key是否正确，或查看控制台的具体错误信息

## 临时方案

如果暂时无法配置Key，代码已经优化为：
- 自动检测Key未配置时使用模拟数据
- Key格式错误时也会自动切换到模拟数据
- 这样你可以先测试其他功能

但**建议尽快配置真实的Key**，以获得真实的搜索结果。

