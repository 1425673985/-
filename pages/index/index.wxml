<view class="container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="custom-navbar" style="padding-top: {{statusBarHeight}}px;">
    <view class="navbar-content" style="height: {{navBarHeight}}px;">
      <view class="navbar-title-wrapper">
        <text class="navbar-title {{titleAnimate ? 'animate-title-fade-in' : ''}}">é™„è¿‘å¯»å•</text>
        <text class="navbar-status {{titleAnimate ? 'animate-title-fade-in' : ''}}" style="animation-delay: 0.1s;">
          <text wx:if="{{searchStatus === 'locating'}}">æ­£åœ¨ä¸ºæ‚¨å¯»æ‰¾é™„è¿‘å•æ‰€...</text>
          <text wx:elif="{{searchStatus === 'found'}}">å·²ä¸ºæ‚¨ç­›é€‰é™„è¿‘å•æ‰€</text>
          <text wx:elif="{{searchStatus === 'noResult'}}">é™„è¿‘æš‚æ— å¯ç”¨å•æ‰€</text>
        </text>
      </view>
    </view>
  </view>
  <!-- åœ°å›¾åŒºåŸŸ -->
  <view class="map-wrapper" style="margin-top: {{totalNavBarHeight || 128}}rpx;">
    <map
      id="map"
      class="map-container"
      longitude="{{longitude}}"
      latitude="{{latitude}}"
      scale="{{scale}}"
      markers="{{markers}}"
      show-location="{{showLocation}}"
      bindtap="onMapTap"
      enable-poi="{{false}}"
      enable-building="{{false}}"
      enable-3D="{{false}}"
      enable-overlooking="{{false}}"
      enable-rotate="{{false}}"
      enable-scroll="{{true}}"
      enable-zoom="{{true}}"
      show-compass="{{false}}"
      show-scale="{{false}}"
    ></map>
    <!-- å·¦ä¾§å®šä½æŒ‰é’®ï¼ˆç”¨æˆ·ä½ç½®ï¼‰ - é€šè¿‡ showLocationButtons å¼€å…³æ§åˆ¶æ˜¾ç¤º -->
    <view class="location-btn location-btn-left" bindtap="locateUser" wx:if="{{showLocationButtons}}">
      <text class="location-icon location-icon-user">ğŸ“</text>
    </view>
    <!-- å³ä¾§å®šä½æŒ‰é’®ï¼ˆå•æ‰€ä½ç½®ï¼‰ - é€šè¿‡ showLocationButtons å¼€å…³æ§åˆ¶æ˜¾ç¤º -->
    <view class="location-btn location-btn-right" bindtap="locateToToilet" wx:if="{{showLocationButtons}}">
      <text class="location-icon location-icon-toilet">ğŸ“</text>
    </view>
  </view>

  <!-- å•æ‰€ä¿¡æ¯å¡ç‰‡ - å¯¼èˆªç±»å°ç¨‹åºä¼˜åŒ–ï¼šåˆ†ç»„å‘ˆç° -->
  <view class="toilet-card {{cardAnimate ? 'animate-fade-in-up' : ''}}" wx:if="{{currentToilet}}">
    <!-- æ¨è/ä¼˜å…ˆæ ‡ç­¾ï¼ˆéå¼ºè§†è§‰ï¼‰ -->
    <view class="toilet-recommend-badge" wx:if="{{currentToilet.isNearest || currentToilet.isRecommended}}">
      <text class="recommend-badge-text">{{currentToilet.isNearest ? 'æ¨è' : 'ä¼˜å…ˆ'}}</text>
    </view>

    <!-- è¡ŒåŠ¨ä¿¡æ¯ç»„ï¼šæ­¥è¡Œæ—¶é—´ã€è·ç¦»ï¼ˆå¯¼èˆªå†³ç­–æ ¸å¿ƒï¼‰ -->
    <view class="toilet-action-group">
      <view class="walking-time-wrapper">
        <text class="walking-time-icon">ğŸš¶</text>
        <text class="walking-time-text">{{currentToilet.walkingTimeText || 'è®¡ç®—ä¸­...'}}</text>
        <text class="walking-time-label">æ­¥è¡Œ</text>
      </view>
      <view class="distance-info">
        <text class="distance-value">{{currentToilet.distance}}</text>
        <text class="distance-unit">m</text>
      </view>
    </view>

    <!-- åœ°ç‚¹æè¿°ç»„ï¼šåç§°ã€åœ°å€ã€ç±»å‹ã€è¯„åˆ†ã€è®¾æ–½ç­‰ -->
    <view class="toilet-location-group">
      <!-- åç§°è¡Œï¼šåç§° + ç±»å‹æ ‡ç­¾ -->
      <view class="toilet-name-row">
        <text class="toilet-name">{{currentToilet.title}}</text>
        <text class="toilet-type-tag" wx:if="{{currentToilet.type}}">{{currentToilet.type === 'public' ? 'å…¬å…±' : currentToilet.type === 'mall' ? 'å•†åœº' : currentToilet.type === 'subway' ? 'åœ°é“' : ''}}</text>
      </view>

      <!-- åœ°å€ä¿¡æ¯ï¼ˆå¼±åŒ–å¤„ç†ï¼‰ -->
      <view class="toilet-address-row-weak">
        <text class="address-icon-weak">ğŸ“</text>
        <text class="address-text-weak">{{currentToilet.displayAddress || currentToilet.detailAddress || currentToilet.address}}</text>
      </view>

      <!-- è¾…åŠ©ä¿¡æ¯ï¼šè¯„åˆ†ã€è®¾æ–½ï¼ˆå¯é€‰æ˜¾ç¤ºï¼‰ -->
      <view class="toilet-extended-info" wx:if="{{currentToilet.rating || currentToilet.facilities}}">
        <view class="toilet-rating" wx:if="{{currentToilet.rating}}">
          <view class="rating-stars">
            <text wx:for="{{[1,2,3,4,5]}}" wx:key="index" class="star {{index <= currentToilet.rating ? 'filled' : ''}}">â˜…</text>
          </view>
          <text class="rating-text">{{currentToilet.rating}}åˆ†</text>
        </view>
        <view class="toilet-facilities" wx:if="{{currentToilet.facilities && currentToilet.facilities.length > 0}}">
          <text class="facility-tag" wx:for="{{currentToilet.facilities}}" wx:key="index" wx:for-item="facility">
            <text wx:if="{{facility === 'accessible'}}">â™¿ æ— éšœç¢</text>
            <text wx:elif="{{facility === 'baby'}}">ğŸ‘¶ æ¯å©´</text>
            <text wx:elif="{{facility === 'clean'}}">âœ¨ å¹²å‡€</text>
            <text wx:else>{{facility}}</text>
          </text>
        </view>
      </view>

      <!-- æ ‡ç­¾ç»„ï¼ˆå¯é€‰æ˜¾ç¤ºï¼‰ -->
      <view class="toilet-tags" wx:if="{{currentToilet.comments && currentToilet.comments.length > 0}}">
        <text class="toilet-tag" wx:for="{{currentToilet.comments}}" wx:key="index" wx:for-item="comment">{{comment}}</text>
      </view>
    </view>

    <!-- ä¿¡ä»»æç¤ºï¼šè½»é‡çº§ï¼Œä¸å¹²æ‰°ä¸»æµç¨‹ -->
    <view class="toilet-trust-hint" wx:if="{{currentToilet && searchStatus === 'found'}}">
      <text class="trust-hint-text">å·²æŒ‰è·ç¦»æ’åº</text>
    </view>
  </view>

  <!-- åŠ è½½æç¤º -->
  <view class="loading" wx:if="{{loading}}">
    <text>æ­£åœ¨æŸ¥æ‰¾é™„è¿‘å•æ‰€...</text>
  </view>

  <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ - åº”æ€¥åœºæ™¯ä¼˜åŒ–ï¼šä¸»æŒ‰é’®åœ¨å³ä¾§ï¼ˆæ‹‡æŒ‡çƒ­åŒºï¼‰ -->
  <view class="action-buttons">
    <!-- æ¬¡æŒ‰é’®ï¼šæ¢ä¸€ä¸ªï¼ˆå·¦ä¾§ï¼Œå¼±åŒ–å¤„ç†ï¼‰ -->
    <button class="action-btn-secondary" bindtap="switchToNextToilet" disabled="{{toiletList.length <= 1}}">
      æ¢ä¸€ä¸ª
    </button>
    <!-- ä¸»æŒ‰é’®ï¼šç«‹å³å¯¼èˆªï¼ˆå³ä¾§ï¼Œè§†è§‰æƒé‡æœ€é«˜ï¼‰ -->
    <button class="action-btn-primary" bindtap="navigateToToilet" disabled="{{!currentToilet}}">
      ç«‹å³å¯¼èˆª
    </button>
  </view>

  <!-- å¹¿å‘ŠåŒºåŸŸï¼ˆé¢„ç•™ï¼‰ -->
  <view class="ad-container">
    <!-- å¹¿å‘Šå†…å®¹å¯ä»¥åœ¨è¿™é‡Œæ’å…¥ -->
  </view>

  <!-- è‡ªå®šä¹‰åº•éƒ¨æç¤º -->
  <view class="custom-toast" wx:if="{{showToast}}">
    <text class="toast-text">{{toastMessage}}</text>
  </view>
</view>

